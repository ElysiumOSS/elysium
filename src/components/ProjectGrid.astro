---
import type { Project } from "@/types";

const projectsData: Omit<Project, "imageUrl">[] = [
	{
		id: "garden-core",
		title: "Garden Core",
		description:
			"Foundation libraries and utilities for the Garden ecosystem. Core functionality for all projects.",
		tags: ["TypeScript", "Core"],
		link: "https://github.com/WomB0ComB0/garden-core",
	},
	{
		id: "harmony",
		title: "Harmony",
		description:
			"A composable state management library for building complex applications with elegant simplicity.",
		tags: ["State Management", "React"],
		link: "https://github.com/WomB0ComB0/harmony",
	},
	{
		id: "prisma-utils",
		title: "Prisma Utils",
		description:
			"Collection of utilities and helpers for working with Prisma ORM. Streamline your database operations.",
		tags: ["Database", "Utilities"],
		link: "https://github.com/WomB0ComB0/prisma-utils",
	},
	{
		id: "ui-system",
		title: "UI System",
		description:
			"Accessible and customizable React component library built with Radix UI primitives.",
		tags: ["Components", "Design System"],
		link: "#",
	},
	{
		id: "auth-js",
		title: "Auth.js Integration",
		description:
			"Seamless authentication solutions with Auth.js. Support for multiple providers and strategies.",
		tags: ["Authentication", "Security"],
		link: "#",
	},
	{
		id: "cli-toolkit",
		title: "CLI Toolkit",
		description:
			"Developer-friendly command-line tools for scaffolding and automation within the Garden ecosystem.",
		tags: ["CLI", "Developer Tools"],
		link: "#",
	},
];

const projects = await Promise.all(
	projectsData.map(async (project) => {
		if (project.link === "#") {
			return { ...project, imageUrl: "https://placehold.co/1200x630" };
		}
		try {
			const response = await fetch(
				`${Astro.url.origin}/api/fetch-og-image?url=${encodeURIComponent(project.link)}`,
			);
			if (!response.ok) {
				return { ...project, imageUrl: "https://placehold.co/1200x630" };
			}
			const { imageUrl } = await response.json();
			return { ...project, imageUrl };
		} catch (error) {
			console.error(`Failed to fetch OG image for ${project.title}:`, error);
			return { ...project, imageUrl: "https://placehold.co/1200x630" };
		}
	}),
);
---

<section class="projects" id="projects">
<div class="container">
<div class="grid">
{projects.map((project) => (
<a href={project.link || '#'} class="project-card" style={`--card-color-hsl: var(--color-primary-hsl)`}>
	{project.imageUrl && <img src={project.imageUrl} alt={project.title} class="project-image" />}
<div class="card-content">
<h3>{project.title}</h3>
<p>{project.description}</p>
<div class="tags">
{project.tags.map((tag) => (
<span class="tag">{tag}</span>
))}
</div>
</div>
<div class="card-footer">
<div class="card-arrow">â†’</div>
</div>
</a>
))}
</div>
</div>
</section>

<style>
.projects {
padding: 5rem 1rem;
background-color: rgba(15, 10, 26, 0.5);
backdrop-filter: blur(10px);
}

.container {
max-width: 1400px;
margin: 0 auto;
}

.grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
gap: 2rem;
}

.project-card {
position: relative;
background: linear-gradient(145deg, hsla(var(--color-dark-hsl), 0.4), hsla(var(--color-dark-hsl), 0.2));
border: 1px solid hsla(var(--color-text-hsl), 0.1);
border-radius: 0.75rem;
transition: all 0.3s ease;
overflow: hidden;
display: flex;
flex-direction: column;
justify-content: space-between;
min-height: 280px;
cursor: pointer;
box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.project-image {
	width: 100%;
	height: 200px;
	object-fit: cover;
	border-bottom: 1px solid hsla(var(--color-text-hsl), 0.1);
}

.project-card:hover {
transform: translateY(-6px);
box-shadow: 0 12px 24px rgba(0,0,0,0.3);
border-color: hsla(var(--color-primary-hsl), 0.5);
}

.card-content {
flex-grow: 1;
padding: 2rem;
margin-bottom: 0;
}

.project-card h3 {
font-size: 1.4rem;
color: var(--color-text);
margin-bottom: 0.75rem;
font-weight: 600;
letter-spacing: -0.01em;
}

.project-card p {
color: var(--color-text-muted);
font-size: 0.95rem;
line-height: 1.6;
margin-bottom: 1.25rem;
}

.tags {
display: flex;
flex-wrap: wrap;
gap: 0.5rem;
}

.tag {
display: inline-block;
background-color: hsla(var(--color-primary-hsl), 0.15);
color: hsl(var(--color-primary-hsl));
padding: 0.35rem 0.75rem;
border-radius: 0.3rem;
font-size: 0.75rem;
font-weight: 500;
letter-spacing: 0.02em;
}

.card-footer {
display: flex;
align-items: center;
justify-content: space-between;
padding: 0 2rem 2rem;
}

.card-arrow {
color: hsl(var(--card-color-hsl));
font-size: 1.5rem;
opacity: 0.6;
transition: all 0.3s ease;
font-weight: 300;
}

.project-card:hover .card-arrow {
opacity: 1;
transform: translateX(6px);
}

 @media (max-width: 768px) {
.projects {
padding: 3rem 1rem;
}

.grid {
grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
gap: 1.5rem;
}

.project-card {
padding: 0;
min-height: 250px;
}

.project-card h3 {
font-size: 1.2rem;
}
}

 @media (max-width: 480px) {
.grid {
grid-template-columns: 1fr;
}

.project-card {
min-height: auto;
}
}
</style>